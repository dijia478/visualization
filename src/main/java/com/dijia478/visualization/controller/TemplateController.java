package com.dijia478.visualization.controller;

import com.github.jknack.handlebars.Handlebars;
import com.github.jknack.handlebars.Template;
import org.icepear.echarts.Line;
import org.icepear.echarts.charts.line.LineSeries;
import org.icepear.echarts.components.coord.cartesian.CategoryAxis;
import org.icepear.echarts.components.series.LineStyle;
import org.icepear.echarts.render.Engine;
import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.RequestParam;
import org.springframework.web.bind.annotation.RestController;

import java.io.IOException;

/**
 * @author dijia478
 * @date 2023/8/4
 */
@RestController
public class TemplateController {

    @PostMapping("loanCalculator")
    public String loanCalculator(@RequestParam("amount") String amount, @RequestParam("rate") String rate, @RequestParam("year") String year, @RequestParam("type") String type) {
        System.out.println(amount + rate + year + type);
        return "ok";
    }

    @GetMapping("/")
    public String index() {
        Handlebars handlebars = new Handlebars();
        String html = "";
        try {
            Template template = handlebars.compile("templates/index1");
            html = template.apply("ECharts Java");
        } catch (IOException e) {
            System.out.println("template file not found");
        }
        return html;
    }

    @GetMapping("/linechart")
    public ResponseEntity<String> getChart() {

        String[] strings = new String[360];
        for (int i = 0; i < strings.length; i++) {
            strings[i] = (i + 1) + "";
        }

        String s = "1505000.00 ,1509992.80 ,1514978.36 ,1519956.68 ,1524927.72 ,1529891.46 ,1534847.87 ,1539796.93 ,1544738.63 ,1549672.92 ,1554599.79 ,1559519.21 ,1564431.15 ,1569335.61 ,1574232.53 ,1579121.91 ,1584003.72 ,1588877.93 ,1593744.52 ,1598603.45 ,1603454.72 ,1608298.28 ,1613134.12 ,1617962.20 ,1622782.51 ,1627595.02 ,1632399.70 ,1637196.52 ,1641985.46 ,1646766.49 ,1651539.59 ,1656304.73 ,1661061.88 ,1665811.02 ,1670552.11 ,1675285.14 ,1680010.08 ,1684726.89 ,1689435.56 ,1694136.05 ,1698828.34 ,1703512.40 ,1708188.21 ,1712855.72 ,1717514.93 ,1722165.79 ,1726808.29 ,1731442.39 ,1736068.07 ,1740685.30 ,1745294.04 ,1749894.28 ,1754485.98 ,1759069.12 ,1763643.66 ,1768209.58 ,1772766.85 ,1777315.44 ,1781855.32 ,1786386.46 ,1790908.84 ,1795422.42 ,1799927.17 ,1804423.07 ,1808910.09 ,1813388.19 ,1817857.34 ,1822317.53 ,1826768.71 ,1831210.85 ,1835643.94 ,1840067.92 ,1844482.79 ,1848888.50 ,1853285.02 ,1857672.33 ,1862050.40 ,1866419.18 ,1870778.66 ,1875128.80 ,1879469.57 ,1883800.93 ,1888122.87 ,1892435.34 ,1896738.31 ,1901031.76 ,1905315.64 ,1909589.94 ,1913854.61 ,1918109.63 ,1922354.96 ,1926590.57 ,1930816.43 ,1935032.50 ,1939238.76 ,1943435.16 ,1947621.69 ,1951798.29 ,1955964.95 ,1960121.63 ,1964268.29 ,1968404.91 ,1972531.44 ,1976647.86 ,1980754.12 ,1984850.21 ,1988936.07 ,1993011.69 ,1997077.02 ,2001132.03 ,2005176.68 ,2009210.95 ,2013234.79 ,2017248.18 ,2021251.07 ,2025243.44 ,2029225.24 ,2033196.45 ,2037157.02 ,2041106.92 ,2045046.12 ,2048974.58 ,2052892.26 ,2056799.13 ,2060695.15 ,2064580.29 ,2068454.51 ,2072317.77 ,2076170.04 ,2080011.27 ,2083841.45 ,2087660.51 ,2091468.44 ,2095265.19 ,2099050.73 ,2102825.01 ,2106588.00 ,2110339.67 ,2114079.97 ,2117808.86 ,2121526.32 ,2125232.29 ,2128926.75 ,2132609.66 ,2136280.97 ,2139940.64 ,2143588.65 ,2147224.94 ,2150849.48 ,2154462.24 ,2158063.16 ,2161652.22 ,2165229.37 ,2168794.58 ,2172347.79 ,2175888.98 ,2179418.11 ,2182935.12 ,2186439.99 ,2189932.68 ,2193413.13 ,2196881.31 ,2200337.19 ,2203780.71 ,2207211.84 ,2210630.54 ,2214036.76 ,2217430.46 ,2220811.61 ,2224180.16 ,2227536.06 ,2230879.28 ,2234209.77 ,2237527.50 ,2240832.41 ,2244124.46 ,2247403.62 ,2250669.84 ,2253923.08 ,2257163.29 ,2260390.43 ,2263604.46 ,2266805.33 ,2269992.99 ,2273167.42 ,2276328.55 ,2279476.35 ,2282610.77 ,2285731.77 ,2288839.30 ,2291933.32 ,2295013.78 ,2298080.64 ,2301133.85 ,2304173.37 ,2307199.15 ,2310211.14 ,2313209.31 ,2316193.59 ,2319163.96 ,2322120.35 ,2325062.73 ,2327991.04 ,2330905.25 ,2333805.29 ,2336691.14 ,2339562.73 ,2342420.03 ,2345262.97 ,2348091.53 ,2350905.64 ,2353705.26 ,2356490.34 ,2359260.84 ,2362016.69 ,2364757.87 ,2367484.31 ,2370195.97 ,2372892.80 ,2375574.74 ,2378241.75 ,2380893.79 ,2383530.79 ,2386152.71 ,2388759.50 ,2391351.11 ,2393927.49 ,2396488.59 ,2399034.35 ,2401564.72 ,2404079.66 ,2406579.12 ,2409063.03 ,2411531.35 ,2413984.03 ,2416421.01 ,2418842.25 ,2421247.69 ,2423637.27 ,2426010.95 ,2428368.67 ,2430710.37 ,2433036.02 ,2435345.54 ,2437638.89 ,2439916.02 ,2442176.86 ,2444421.37 ,2446649.50 ,2448861.17 ,2451056.35 ,2453234.98 ,2455397.00 ,2457542.35 ,2459670.98 ,2461782.84 ,2463877.87 ,2465956.01 ,2468017.20 ,2470061.40 ,2472088.54 ,2474098.57 ,2476091.42 ,2478067.05 ,2480025.39 ,2481966.39 ,2483889.99 ,2485796.12 ,2487684.75 ,2489555.79 ,2491409.21 ,2493244.93 ,2495062.89 ,2496863.05 ,2498645.34 ,2500409.70 ,2502156.06 ,2503884.38 ,2505594.59 ,2507286.63 ,2508960.44 ,2510615.95 ,2512253.12 ,2513871.87 ,2515472.15 ,2517053.88 ,2518617.03 ,2520161.51 ,2521687.26 ,2523194.24 ,2524682.36 ,2526151.58 ,2527601.82 ,2529033.03 ,2530445.13 ,2531838.07 ,2533211.79 ,2534566.21 ,2535901.27 ,2537216.92 ,2538513.08 ,2539789.69 ,2541046.68 ,2542284.00 ,2543501.57 ,2544699.32 ,2545877.20 ,2547035.13 ,2548173.05 ,2549290.90 ,2550388.60 ,2551466.08 ,2552523.29 ,2553560.15 ,2554576.60 ,2555572.56 ,2556547.98 ,2557502.77 ,2558436.88 ,2559350.23 ,2560242.75 ,2561114.38 ,2561965.04 ,2562794.67 ,2563603.19 ,2564390.53 ,2565156.63 ,2565901.41 ,2566624.81 ,2567326.74 ,2568007.14 ,2568665.95 ,2569303.07 ,2569918.45 ,2570512.01 ,2571083.68 ,2571633.38 ,2572161.04 ,2572666.59 ,2573149.96 ,2573611.07 ,2574049.84 ,2574466.20 ,2574860.09 ,2575231.41 ,2575580.10 ,2575906.08 ,2576209.28 ,2576489.62 ,2576747.02 ,2576981.41 ,2577192.71 ,2577380.84 ,2577545.73 ,2577687.30 ,2577805.47 ,2577900.16 ,2577971.30 ,2578018.80 ,2578042.60";
        String[] split = s.split(" ,");
        String s1 = "1504986.11 ,1509958.33 ,1514916.67 ,1519861.11 ,1524791.67 ,1529708.33 ,1534611.11 ,1539500.00 ,1544375.00 ,1549236.11 ,1554083.33 ,1558916.67 ,1563736.11 ,1568541.67 ,1573333.33 ,1578111.11 ,1582875.00 ,1587625.00 ,1592361.11 ,1597083.33 ,1601791.67 ,1606486.11 ,1611166.67 ,1615833.33 ,1620486.11 ,1625125.00 ,1629750.00 ,1634361.11 ,1638958.33 ,1643541.67 ,1648111.11 ,1652666.67 ,1657208.33 ,1661736.11 ,1666250.00 ,1670750.00 ,1675236.11 ,1679708.33 ,1684166.67 ,1688611.11 ,1693041.67 ,1697458.33 ,1701861.11 ,1706250.00 ,1710625.00 ,1714986.11 ,1719333.33 ,1723666.67 ,1727986.11 ,1732291.67 ,1736583.33 ,1740861.11 ,1745125.00 ,1749375.00 ,1753611.11 ,1757833.33 ,1762041.67 ,1766236.11 ,1770416.67 ,1774583.33 ,1778736.11 ,1782875.00 ,1787000.00 ,1791111.11 ,1795208.33 ,1799291.67 ,1803361.11 ,1807416.67 ,1811458.33 ,1815486.11 ,1819500.00 ,1823500.00 ,1827486.11 ,1831458.33 ,1835416.67 ,1839361.11 ,1843291.67 ,1847208.33 ,1851111.11 ,1855000.00 ,1858875.00 ,1862736.11 ,1866583.33 ,1870416.67 ,1874236.11 ,1878041.67 ,1881833.33 ,1885611.11 ,1889375.00 ,1893125.00 ,1896861.11 ,1900583.33 ,1904291.67 ,1907986.11 ,1911666.67 ,1915333.33 ,1918986.11 ,1922625.00 ,1926250.00 ,1929861.11 ,1933458.33 ,1937041.67 ,1940611.11 ,1944166.67 ,1947708.33 ,1951236.11 ,1954750.00 ,1958250.00 ,1961736.11 ,1965208.33 ,1968666.67 ,1972111.11 ,1975541.67 ,1978958.33 ,1982361.11 ,1985750.00 ,1989125.00 ,1992486.11 ,1995833.33 ,1999166.67 ,2002486.11 ,2005791.67 ,2009083.33 ,2012361.11 ,2015625.00 ,2018875.00 ,2022111.11 ,2025333.33 ,2028541.67 ,2031736.11 ,2034916.67 ,2038083.33 ,2041236.11 ,2044375.00 ,2047500.00 ,2050611.11 ,2053708.33 ,2056791.67 ,2059861.11 ,2062916.67 ,2065958.33 ,2068986.11 ,2072000.00 ,2075000.00 ,2077986.11 ,2080958.33 ,2083916.67 ,2086861.11 ,2089791.67 ,2092708.33 ,2095611.11 ,2098500.00 ,2101375.00 ,2104236.11 ,2107083.33 ,2109916.67 ,2112736.11 ,2115541.67 ,2118333.33 ,2121111.11 ,2123875.00 ,2126625.00 ,2129361.11 ,2132083.33 ,2134791.67 ,2137486.11 ,2140166.67 ,2142833.33 ,2145486.11 ,2148125.00 ,2150750.00 ,2153361.11 ,2155958.33 ,2158541.67 ,2161111.11 ,2163666.67 ,2166208.33 ,2168736.11 ,2171250.00 ,2173750.00 ,2176236.11 ,2178708.33 ,2181166.67 ,2183611.11 ,2186041.67 ,2188458.33 ,2190861.11 ,2193250.00 ,2195625.00 ,2197986.11 ,2200333.33 ,2202666.67 ,2204986.11 ,2207291.67 ,2209583.33 ,2211861.11 ,2214125.00 ,2216375.00 ,2218611.11 ,2220833.33 ,2223041.67 ,2225236.11 ,2227416.67 ,2229583.33 ,2231736.11 ,2233875.00 ,2236000.00 ,2238111.11 ,2240208.33 ,2242291.67 ,2244361.11 ,2246416.67 ,2248458.33 ,2250486.11 ,2252500.00 ,2254500.00 ,2256486.11 ,2258458.33 ,2260416.67 ,2262361.11 ,2264291.67 ,2266208.33 ,2268111.11 ,2270000.00 ,2271875.00 ,2273736.11 ,2275583.33 ,2277416.67 ,2279236.11 ,2281041.67 ,2282833.33 ,2284611.11 ,2286375.00 ,2288125.00 ,2289861.11 ,2291583.33 ,2293291.67 ,2294986.11 ,2296666.67 ,2298333.33 ,2299986.11 ,2301625.00 ,2303250.00 ,2304861.11 ,2306458.33 ,2308041.67 ,2309611.11 ,2311166.67 ,2312708.33 ,2314236.11 ,2315750.00 ,2317250.00 ,2318736.11 ,2320208.33 ,2321666.67 ,2323111.11 ,2324541.67 ,2325958.33 ,2327361.11 ,2328750.00 ,2330125.00 ,2331486.11 ,2332833.33 ,2334166.67 ,2335486.11 ,2336791.67 ,2338083.33 ,2339361.11 ,2340625.00 ,2341875.00 ,2343111.11 ,2344333.33 ,2345541.67 ,2346736.11 ,2347916.67 ,2349083.33 ,2350236.11 ,2351375.00 ,2352500.00 ,2353611.11 ,2354708.33 ,2355791.67 ,2356861.11 ,2357916.67 ,2358958.33 ,2359986.11 ,2361000.00 ,2362000.00 ,2362986.11 ,2363958.33 ,2364916.67 ,2365861.11 ,2366791.67 ,2367708.33 ,2368611.11 ,2369500.00 ,2370375.00 ,2371236.11 ,2372083.33 ,2372916.67 ,2373736.11 ,2374541.67 ,2375333.33 ,2376111.11 ,2376875.00 ,2377625.00 ,2378361.11 ,2379083.33 ,2379791.67 ,2380486.11 ,2381166.67 ,2381833.33 ,2382486.11 ,2383125.00 ,2383750.00 ,2384361.11 ,2384958.33 ,2385541.67 ,2386111.11 ,2386666.67 ,2387208.33 ,2387736.11 ,2388250.00 ,2388750.00 ,2389236.11 ,2389708.33 ,2390166.67 ,2390611.11 ,2391041.67 ,2391458.33 ,2391861.11 ,2392250.00 ,2392625.00 ,2392986.11 ,2393333.33 ,2393666.67 ,2393986.11 ,2394291.67 ,2394583.33 ,2394861.11 ,2395125.00 ,2395375.00 ,2395611.11 ,2395833.33 ,2396041.67 ,2396236.11 ,2396416.67 ,2396583.33 ,2396736.11 ,2396875.00 ,2397000.00 ,2397111.11 ,2397208.33 ,2397291.67 ,2397361.11 ,2397416.67 ,2397458.33 ,2397486.11 ,2397500.00 ,2397500.00";
        String[] split1 = s1.split(" ,");

        Line line = new Line()
                .setTitle("Stacked Area")
                .setTooltip("axis")
                .setLegend()
                .addXAxis(new CategoryAxis()
                        .setBoundaryGap(false)
                        .setData(strings))
                .addYAxis()
                .addSeries(createSeries("等额本息已还+剩余本金", split))
                .addSeries(createSeries("等额本金已还+剩余本金", split1));
        Engine engine = new Engine();
        String json = engine.renderHtml(line);
        return ResponseEntity.ok(json);
    }

    LineSeries createSeries(String name, Object[] data) {
        return new LineSeries()
                .setName(name)
                // .setStack("Total")
                .setSmooth(true)
                .setLineStyle(new LineStyle().setWidth(2))
                .setShowSymbol(false)
                // .setAreaStyle(new LineAreaStyle())
                .setData(data);
    }

}
