<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>公众号：万户楼台</title>
    <link href="http://cdn.bootcss.com/bootstrap/4.6.1/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://lf9-cdn-tos.bytecdntp.com/cdn/expire-1-M/jquery/3.6.0/jquery.min.js" type="application/javascript"></script>
    <link rel="stylesheet" type="text/css" href="css/index.css">
</head>
<body>

<div class="container">
    <div class="row">
        <div class="col-md-12" style="padding:2em 0;">
            <div class="table-responsive">
                <table class="table table-bordered table-striped" id="mytable">
                    <thead>
                    <tr>
                        <td>影响因子</td>
                        <td>数值（手动填写）</td>
                        <td>说明</td>
                    </tr>
                    </thead>
                    <tbody>
                    <tr>
                        <td>平均日薪酬</td>
                        <td id="num1" class="input" onclick="cellClicked(this)"></td>
                        <td>元（每月按22天算）</td>
                    </tr>
                    <tr>
                        <td>工作时长</td>
                        <td id="num2" class="input" onclick="cellClicked(this)"></td>
                        <td>下班时间-上班时间</td>
                    </tr>
                    <tr>
                        <td>通勤时长</td>
                        <td id="num3" class="input" onclick="cellClicked(this)"></td>
                        <td>小时</td>
                    </tr>
                    <tr>
                        <td>摸鱼时长</td>
                        <td id="num4" class="input" onclick="cellClicked(this)"></td>
                        <td>不干活+吃饭+午休</td>
                    </tr>
                    <tr>
                        <td>学历系数</td>
                        <td id="num5" class="select" onclick="cellClicked(this)"></td>
                        <td>专科及以下0.8<br>
                            普通本科1.0<br>
                            985/211本科1.2<br>
                            普通硕士1.4<br>
                            985/211硕士1.6<br>
                            普通博士1.8<br>
                            985/211博士2.0
                        </td>
                    </tr>
                    <tr>
                        <td>工作环境系数</td>
                        <td id="num6" class="select" onclick="cellClicked(this)"></td>
                        <td>偏僻郊区工厂户外0.8<br>
                            市内工厂户外0.9<br>
                            普通1.0<br>
                            CBD/体制内1.1
                        </td>
                    </tr>
                    <tr>
                        <td>异性环境系数</td>
                        <td id="num7" class="select" onclick="cellClicked(this)"></td>
                        <td>没有0.9<br>
                            不多不少1.0<br>
                            很多1.1
                        </td>
                    </tr>
                    <tr>
                        <td>同事环境系数</td>
                        <td id="num8" class="select" onclick="cellClicked(this)"></td>
                        <td>SB很多0.95<br>
                            普通很多1.0<br>
                            优秀很多1.05
                        </td>
                    </tr>
                    <tr>
                        <td>职业资格系数</td>
                        <td id="num9" class="select" onclick="cellClicked(this)"></td>
                        <td>无要求、二级1<br>
                            建造造价监理1.05<br>
                            建筑岩土结构1.1<br>
                            主任医师、教授1.15
                        </td>
                    </tr>
                    <tr>
                        <td>上班时间系数</td>
                        <td id="num10" class="select" onclick="cellClicked(this)"></td>
                        <td>8点以前0.7<br>
                            8点及以后0.8<br>
                            8点半及以后0.9<br>
                            9点及以后1.0<br>
                            10点及以后1.1<br>
                        </td>
                    </tr>
                    <tr>
                        <td>综合环境系数</td>
                        <td id="num11">0.00</td>
                        <td>不要改</td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<div class="result-container">
    <div class="row">
        <div class="col-md-12" style="padding:2em 0;">
            <div class="table-responsive">
                <table class="table table-bordered" id="result-table">
                    <tbody>
                    <tr>
                        <td rowspan="2">工作性价比</td>
                        <td id="resultDesc">很惨</td>
                        <td rowspan="2">
                            小于1很惨<br>
                            大于1一般<br>
                            大于2不错<br>
                            大于4很爽<br>
                            大于10爽到爆
                        </td>
                    </tr>
                    <tr>
                        <td id="result">0.00</td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>


<script type="text/javascript">
    let activeCell = null;

    function cellClicked(cell) {
        if (activeCell === cell) {
            console.log("相同的不处理");
            return;
        } else {
            let $cell = $(activeCell);
            if ($cell.attr('status') === 'editing') {
                let cont;
                if (activeCell.className === 'input') {
                    cont = $cell.find('input').val();
                } else if (activeCell.className === 'select') {
                    cont = $cell.find('select').val();
                }
                $cell.html(cont);
                $cell.attr('status', '');
            }
        }

        let $cell = $(cell);
        if ($cell.attr('status') === 'editing') {
            console.log("已经编辑中的不处理");
            return;
        }

        let div = getInsertDiv(cell);
        $cell.html(div);
        $cell.attr('status', 'editing');
        activeCell = cell;
    }

    let num5Map = new Map();
    num5Map.set('专科及以下', 0.8);
    num5Map.set('普通本科', 1.0);
    num5Map.set('985/211本科', 1.2);
    num5Map.set('普通硕士', 1.4);
    num5Map.set('985/211硕士', 1.6);
    num5Map.set('普通博士', 1.8);
    num5Map.set('985/211博士', 2.0);

    let num6Map = new Map();
    num6Map.set('偏僻郊区工厂户外', 0.8);
    num6Map.set('市内工厂户外', 0.9);
    num6Map.set('普通', 1.0);
    num6Map.set('CBD/体制内', 1.1);

    let num7Map = new Map();
    num7Map.set('没有', 0.9);
    num7Map.set('不多不少', 1.0);
    num7Map.set('很多', 1.1);

    let num8Map = new Map();
    num8Map.set('SB很多', 0.95);
    num8Map.set('普通很多', 1.0);
    num8Map.set('优秀很多', 1.05);

    let num9Map = new Map();
    num9Map.set('无要求、二级', 1.0);
    num9Map.set('建造造价监理', 1.05);
    num9Map.set('建筑岩土结构', 1.1);
    num9Map.set('主任医师、教授', 1.15);

    let num10Map = new Map();
    num10Map.set('8点以前', 0.7);
    num10Map.set('8点及以后', 0.8);
    num10Map.set('8点半及以后', 0.9);
    num10Map.set('9点及以后', 1.0);
    num10Map.set('10点及以后', 1.1);

    function getInsertDiv(cell) {
        let cont = $(cell).html();
        let div;
        if (cell.className === 'input') {
            div = '<input class="form-control form-control-sm" value="' + cont + '">';
        } else if (cell.className === 'select') {
            div = '<select class="form-control form-control-sm">'
            let keys = [];
            if (cell.id === 'num5') {
                keys = num5Map.keys();
            } else if (cell.id === 'num6') {
                keys = num6Map.keys();
            } else if (cell.id === 'num7') {
                keys = num7Map.keys();
            } else if (cell.id === 'num8') {
                keys = num8Map.keys();
            } else if (cell.id === 'num9') {
                keys = num9Map.keys();
            } else if (cell.id === 'num10') {
                keys = num10Map.keys();
            }
            for (let key of keys) {
                div += `<option ${cont === key ? 'selected' : ''}>${key}</option>`;
            }

        }
        return div;
    }

    $(document).click(function(event) {
        if (!$(event.target).is('input') && !$(event.target).is('select') &&  activeCell !== event.target) {
            let $activeCell = $(activeCell);
            if ($activeCell.attr('status') !== 'editing') {
                console.log("非编辑中的不取消");
                return;
            }

            let cont
            if (activeCell.className === 'input') {
                cont = $activeCell.find('input').val();
            } else if (activeCell.className === 'select') {
                cont = $(activeCell).find('select').val();
            }
            $activeCell.html(cont);
            $activeCell.attr('status', '');
            activeCell = null;
        }

        let num1 = Number($('#num1').text());
        let num2 = Number($('#num2').text());
        let num3 = Number($('#num3').text());
        let num4 = Number($('#num4').text());
        let num5 = Number(num5Map.get($('#num5').text()));
        let num6 = Number(num6Map.get($('#num6').text()));
        let num7 = Number(num7Map.get($('#num7').text()));
        let num8 = Number(num8Map.get($('#num8').text()));
        let num9 = Number(num9Map.get($('#num9').text()));
        let num10 = Number(num10Map.get($('#num10').text()));
        
        // 综合环境系数
        let factor = num6 * num7 * num8;
        $('#num11').html(factor.toFixed(2));
        // 分母
        let denominator = (35 * (num2 + num3 - 0.5 * num4) * num5 * num9) * num10;
        let result;
        if (denominator === 0) {
            result = 0;
        } else {
            result = num1 * factor / denominator;
        }
        if (result >= 200) {
            $('#resultDesc').html("你是老板");
        } else if (result >= 40) {
            $('#resultDesc').html("神！工作");
        } else if (result >= 10) {
            $('#resultDesc').html("爽到爆！");
        } else if (result >= 4) {
            $('#resultDesc').html("很爽");
        } else if (result >= 2) {
            $('#resultDesc').html("不错");
        } else if (result >= 1) {
            $('#resultDesc').html("一般");
        } else if (result < 1) {
            $('#resultDesc').html("很惨");
        }
        result = result.toFixed(2);
        $('#result').html(result);
    });

</script>
</body>
</html>